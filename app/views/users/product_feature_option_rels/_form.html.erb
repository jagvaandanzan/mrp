<div class="content-wrapper">
  <%= render 'layouts/breadcrumbs', data: [
      [users_products_path, t('titles.products')],
      [users_product_feature_option_rels_path(product_id: @product.id), @product.name],
      t('activerecord.models.product_feature_option_rel') +t('titles.add')
  ] %>

  <section class="content">
    <div class="box box-info">
      <%= form_with model: @option_rel, url: users_product_feature_option_rels_path,
                    method: @option_rel.persisted? ? :patch : :post, local: true, :html => {class: 'form-horizontal'} do |f| %>
        <%= form_body do %>
          <%= f.hidden_field :product_id, value: @product.id %>

          <div class="form-group">
            <%= f.label :product_id, class: 'col-sm-3 control-label' %>
            <div class="col-sm-9">
              <%= f.text_field :product_id, class: 'form-control', value: @product.name, disabled: true %>
            </div>
          </div>


          <div class="form-group">
            <%= f.label :feature_id, class: 'col-sm-3 control-label' %>
            <div class="col-sm-9">
              <%= f.collection_select :feature_id, ProductFeature.search(""), :id, :name,
                                      {:prompt => t('controls.select.none')},
                                      {class: 'form-control pull-left', onchange: 'callFeatureOption(this)'} %>
            </div>
          </div>

          <div class="form-group">
            <%= f.label :feature_option_id, class: 'col-sm-3 control-label' %>
            <div class="col-sm-9">
              <select class="form-control" name="product_feature_option_rel[feature_option_id]" id="product_feature_option_rel_feature_option_id">
                <option value=''>Сонгох</option>
              </select>
            </div>
          </div>
          <div class="action-buttons">
            <%= f.submit t('controls.button.save'), class: 'btn btn-warning' %>
          </div>
        <% end %>
      <% end %>
    </div>
  </section>
</div>

<script>
  function callFeatureOption(featureSelect){
      var feature_id = $(featureSelect).val();
      if(feature_id!="" && feature_id!=undefined && feature_id!=null){
          Rails.ajax({
              url: "<%= get_feature_options_users_product_feature_option_rels_path %>",
              type: "PATCH",
              data: "feature_id=" + feature_id,
              success: function (data) {
                  var options = data.options;
                  if (options!=undefined && options.length > 0) {
                      var optionSelect = $("#product_feature_option_rel_feature_option_id");
                      optionSelect.html("");
                      optionSelect.html("<option value=''>Сонгох</option>");

                      for (var i = 0; i < options.length; i++) {
                          optionSelect.append('<option value="' + options[i]["id"] + '">' + options[i]["name"] + '</option>');
                      }
                  }
              },
              error: function (data) {
                  console.log(data);
              }
          });
      }
  }
</script>