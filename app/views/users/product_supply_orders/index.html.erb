<style>
  div.search{
    padding-left: 0!important;
    padding-right: 5px!important;
  }
  div.search input, div.search select, div.search a{
    font-size: smaller !important;
    height: 30px!important;
    padding-top: 6px;
  }
  div.search input, div.search select, div.search a{
    font-size: smaller !important;
    height: 30px!important;
    padding-top: 6px;
  }
  #searchDate{
    font-size: smaller !important;
    height: 30px!important;
    padding-top: 6px;
    padding-left: 5px !important;
  }

  input#by_close{
    height: 15px !important;
    width: 15px;
    margin-top: 5px;
  }
</style>
<div class="content-wrapper">

  <div class="col-md-12 m-t-10 m-b-10">
    <%= form_with url: users_product_supply_orders_path, method: "get", class: "", local: true do |f| %>
      <div class="col-md-3 search">
        <div id="searchDate" class="form-control search">
          <i class="fa fa-calendar fa-lg p-r-0"></i>
          <span><%= t("filters.product_supply_order.by_date") %>...</span>
          <%= f.hidden_field :by_start, value: @by_start %>
          <%= f.hidden_field :by_end,  value: @by_end %>
        </div>
      </div>
      <div class="col-md-3 search">
        <%= text_field_tag :by_code, @by_code, {class: 'form-control', placeholder: t('filters.product_supply_order.by_code')} %>
      </div>
      <div class="col-md-6 search">
        <%= submit_tag t('controls.button.searching'), :class => 'btn blck-btn pull-left' %>

        <%= link_to t('controls.button.create'), new_users_product_supply_order_path, class: 'btn btn-warning pull-right' %>
      </div>
    <% end %>
  </div>

  <section class="content container-fluid">
    <div class="row">
      <div class="col-xs-12">
        <div class="box" id="div_list">
          <div class="box-body table-responsive no-padding">
            <%= render 'layouts/flash_message' %>
            <table class="table table-hover">
              <tr>
                <th ><%= t('activerecord.attributes.product_supply_order.code') %></th>
                <th ><%= t('activerecord.attributes.product_supply_order.ordered_date') %></th>
                <th ><%= t('activerecord.attributes.product_supply_order.supplier_id') %></th>
                <th><%= t('activerecord.attributes.product_supply_order.payment') %></th>
                <th ><%= t('activerecord.attributes.product_supply_order.exchange') %></th>
                <th ><%= t('activerecord.attributes.product_supply_order.exchange_value') %></th>
                <th ><%= t('activerecord.attributes.product_supply_order.sumPrice') %></th>
                <th ><%= t('activerecord.attributes.product_supply_order.is_closed') %></th>
                <th ></th>
              </tr>
              <% @supply_orders.each do |p| %>
                <tr>
                  <td class="va-mid"><%= link_to p.code, users_product_supply_order_items_path(order_id: p.id) %></td>
                  <td class="va-mid"><%= link_to p.ordered_date.strftime('%F'), users_product_supply_order_items_path(order_id: p.id) %></td>
                  <td class="va-mid"><%= link_to p.supplier.name, users_product_supply_order_items_path(order_id: p.id) %></td>
                  <td class="va-mid"><%= p.payment_i18n %></td>
                  <td class="va-mid"><%= p.exchange_i18n %></td>
                  <td class="va-mid"><%= p.exchange_value %></td>
                  <td class="va-mid"><%= p.sumPrice()  %></td>
                  <td class="va-mid"><%= p.is_closed ? ( p.closed_date.nil? ? "Хаагдсан" : p.closed_date.strftime('%F')) : "" %></td>
                  <td>
                    <div class="btn-group">
                      <%= link_to edit_users_product_supply_order_path(p), class: 'no-underline' do %>
                        <%= button_tag t('controls.button.edit'), class: "btn-sm btn-info m-r-10" %>
                      <% end %>
                      <%= link_to users_product_supply_order_path(p), class: 'no-underline', :method => :delete, data: {confirm: t('are_you_sure')} do %>
                        <%= button_tag t('controls.button.delete'), class: "btn-sm btn-danger" %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </table>
          </div>
        </div>

        <%= paginate @supply_orders %>
      </div>
    </div>
  </section>
</div>

<script>
    $(document).ready(function() {
        var startDate = $('input#by_start');
        var endDate = $('input#by_end');

        $('#searchDate span').html(startDate.val() + '-' + endDate.val());


        $('#searchDate').daterangepicker({
                ranges: {
                    'Өнөөдөр': [moment(), moment()],
                    'Өчигдөр': [moment().subtract('days', 1), moment().subtract('days', 1)],
                    'Сүүлийн 7 хоног': [moment().subtract('days', 6), moment()],
                    'Сүүлийн 30 хоног': [moment().subtract('days', 29), moment()],
                    'Энэ сар': [moment().startOf('month'), moment().endOf('month')],
                    'Өнгөрсөн сар': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
                },
                startDate: moment().subtract('days', 29),
                endDate: moment(),
                format: 'YYYY/MM/DD',
                locale: {
                    applyLabel: 'Болсон',
                    cancelLabel: 'Болих',
                    fromLabel: 'Аас',
                    toLabel: 'Хүртэл',
                    customRangeLabel: 'Өөрөөр сонгох',
                    dayNames: ["Даваа", "Мягмар", "Лхагва", "Пүрэв", "Баасан", "Бямба", "Ням"],
                    daysOfWeek: ["Ня", "Да", "Мя", "Лх", "Пү", "Ба", "Бя"],
                    monthNames: ["Нэгдүгээр сар", "Хоёрдугаар cар", "Гуравдугаар сар", "Дөрөвдүгээр сар", "Тавдугаар сар", "Зургаадугаар сар", "Долоодугаар сар", "Наймдугаар сар", "Есдүгээр сар", "Аравдугаар сар", "Арваннэгдүгээр сар", "Арванхоёрдугаар сар"],
                    firstDay: 1
                }
            },
            function (start, end) {
                $('#searchDate span').html(start.format('YYYY/MM/DD') + '-' + end.format('YYYY/MM/DD'));
                startDate.val(start.format('YYYY/MM/DD'));
                endDate.val(end.format('YYYY/MM/DD'));
            }
        );
        $('#searchDate').on('apply.daterangepicker', function (ev, picker) {
            startDate.val(picker.startDate.format('YYYY/MM/DD'));
            endDate.val(picker.endDate.format('YYYY/MM/DD'));
        });
        $('#searchDate').on('cancel.daterangepicker', function (ev, picker) {
            console.log("cancel event fired");
            $('#searchDate span').html("<%= t("filters.product_supply_order.by_date") %>...");
            startDate.val("");
            endDate.val("");
        });
    });
</script>